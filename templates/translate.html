{% extends "base.html" %}

{% block title %}Translate to Kikuyu{% endblock %}

{% block content %}
<div class="max-w-xl mx-auto px-4 py-8">
    <!-- Title -->
    <h1 class="text-3xl font-bold text-center text-gray-800 mb-6">üåç Help Preserve Kikuyu</h1>
    <p class="text-center text-gray-600 mb-8">Translate the sentence below into Kikuyu and contribute to our language archive.</p>

    <!-- Important Guidelines -->
    <div class="bg-blue-50 border-l-4 border-blue-400 p-4 mb-6">
        <div class="flex items-start">
            <div class="flex-shrink-0">
                <svg class="h-5 w-5 text-blue-400 mt-0.5" fill="currentColor" viewBox="0 0 20 20">
                    <path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z" clip-rule="evenodd" />
                </svg>
            </div>
            <div class="ml-3">
                <h3 class="text-sm font-medium text-blue-800 mb-2">üìù Translation Guidelines</h3>
                <p class="text-sm text-blue-700 mb-2">
                    <strong>Please provide only accurate translations.</strong> Incorrect translations can lead to misinterpretation and damage the integrity of the Kikuyu language documentation. Your translations help preserve our cultural heritage for future generations.
                </p>
                <ul class="text-sm text-blue-700 space-y-1">
                    <li>‚Ä¢ Translate the meaning, not word-for-word</li>
                    <li>‚Ä¢ Use proper Kikuyu grammar and spelling</li>
                    <li>‚Ä¢ Skip if you're unsure rather than guess</li>
                </ul>
            </div>
        </div>
    </div>

    <!-- Privacy Notice -->
    <div class="bg-green-50 border-l-4 border-green-400 p-4 mb-6">
        <div class="flex items-start">
            <div class="flex-shrink-0">
                <svg class="h-5 w-5 text-green-400 mt-0.5" fill="currentColor" viewBox="0 0 20 20">
                    <path fill-rule="evenodd" d="M5 9V7a5 5 0 0110 0v2a2 2 0 012 2v5a2 2 0 01-2 2H5a2 2 0 01-2-2v-5a2 2 0 012-2z" clip-rule="evenodd" />
                </svg>
            </div>
            <div class="ml-3">
                <h3 class="text-sm font-medium text-green-800 mb-2">üîí Your Privacy</h3>
                <p class="text-sm text-green-700">
                    <strong>No personal data is collected.</strong> We only store your translations to build the language database. Your identity, location, and other personal information are not tracked or stored. All contributions are anonymous.
                </p>
            </div>
        </div>
    </div>

    <!-- Prompt Card -->
    <div class="bg-white shadow-md rounded-lg p-6 mb-6 border border-gray-200">
        <p class="text-lg text-gray-700"><strong>English:</strong> <span class="italic">"{{ prompt.text }}"</span></p>
    </div>

    <!-- Translation Form -->
    <form method="POST" id="translationForm" class="space-y-6">
        {{ form.hidden_tag() }}
        {{ form.prompt_id() }}

        <!-- Textarea -->
        <div>
            {{ form.kikuyu_text(class="w-full p-4 border border-gray-300 rounded-lg shadow-sm focus:ring focus:ring-indigo-300 transition", placeholder="Write your Kikuyu translation here...", rows="6", maxlength="1000", id="kikuyuText") }}
            <div class="text-sm text-gray-500 mt-1"><span id="charCounter">0 / 1000</span> characters</div>
        </div>

        <!-- Buttons -->
        <div class="flex justify-center space-x-4">
            <button type="submit" class="bg-green-600 hover:bg-green-700 text-white font-semibold py-2 px-6 rounded-lg transition" id="submitBtn">‚úÖ Submit</button>
            <button type="button" class="bg-yellow-500 hover:bg-yellow-600 text-white font-semibold py-2 px-6 rounded-lg transition" id="skipBtn">‚è≠Ô∏è Skip</button>
            <a href="{{ url_for('main.translate') }}" class="bg-blue-600 hover:bg-blue-700 text-white font-semibold py-2 px-6 rounded-lg transition">üîÑ Next</a>
        </div>
    </form>
</div>

<!-- JavaScript -->
<script>
document.addEventListener('DOMContentLoaded', function() {
    const textArea = document.getElementById('kikuyuText');
    const charCounter = document.getElementById('charCounter');
    const submitBtn = document.getElementById('submitBtn');

    function updateCharCounter() {
        const length = textArea.value.length;
        charCounter.textContent = `${length} / 1000`;

        if (length > 800) {
            charCounter.className = 'text-yellow-600';
        }
        if (length > 950) {
            charCounter.className = 'text-red-600';
        }
        if (length <= 800) {
            charCounter.className = 'text-gray-500';
        }

        submitBtn.disabled = length > 1000;
        submitBtn.style.opacity = length > 1000 ? '0.5' : '1';
        submitBtn.style.cursor = length > 1000 ? 'not-allowed' : 'pointer';
    }

    textArea.addEventListener('input', updateCharCounter);
    textArea.addEventListener('paste', () => setTimeout(updateCharCounter, 10));
    updateCharCounter();

    document.getElementById('translationForm').addEventListener('submit', function(e) {
        const text = textArea.value.trim();
        if (text.length < 2) {
            e.preventDefault();
            alert('Please provide a translation with at least 2 characters.');
            textArea.focus();
            return false;
        }
        if (text.length > 1000) {
            e.preventDefault();
            alert('Translation is too long. Please keep it under 1000 characters.');
            textArea.focus();
            return false;
        }

        submitBtn.innerHTML = '‚è≥ Submitting...';
        submitBtn.disabled = true;
    });

    textArea.addEventListener('input', function() {
        this.style.height = 'auto';
        this.style.height = Math.min(this.scrollHeight, 200) + 'px';
    });

    const skipBtn = document.getElementById('skipBtn');
    if (skipBtn) {
        skipBtn.addEventListener('click', function() {
            skipBtn.innerHTML = '‚è≥ Skipping...';
            skipBtn.disabled = true;

            const form = document.createElement('form');
            form.method = 'POST';
            form.action = '{{ url_for("main.skip_prompt", prompt_id=prompt.id) }}';

            const csrfToken = document.createElement('input');
            csrfToken.type = 'hidden';
            csrfToken.name = 'csrf_token';
            csrfToken.value = '{{ csrf_token() }}';
            form.appendChild(csrfToken);

            document.body.appendChild(form);
            form.submit();
        });
    }
});
</script>
{% endblock %}
